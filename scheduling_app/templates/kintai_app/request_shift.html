{% extends "attendance/app_base.html" %}
{% load static %}
{% load kintai_calendar_tags %}
{% block title %}ã‚·ãƒ•ãƒˆç”³è«‹ç”»é¢{% endblock %}
{% block header_title %}ã‚·ãƒ•ãƒˆç”³è«‹{% endblock %}

{% block content %}
<div class="d-flex flex-column align-items-center mt-4">
    <div style="max-width: 450px; width: 100%;">
        
        {# 1. æ¡ˆå†…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ #}
        <div class="alert alert-primary text-center shadow-sm mb-4" role="alert">
            æ—¥ä»˜ã‚’é¸æŠã—ã¦ä¸€æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®š
        </div>

        {# 2. é€±å˜ä½ç”³è«‹ãƒœã‚¿ãƒ³ #}
        <div class="mb-4 d-grid gap-2">
            <button id="weeklyRequestButton" class="btn btn-success btn-lg">
                ä¸€é€±é–“ã®åŸºæœ¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹
            </button>
        </div>

        {# 3. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºéƒ¨åˆ† #}
        <div class="card shadow-sm mb-5">
            <div class="card-header bg-light text-center">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    {# ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ #}
                    <a href="{% url 'scheduling:request_shift' %}?year={{ prev_year }}&month={{ prev_month }}" class="btn btn-sm btn-outline-primary">&lt; å‰æœˆ</a>
                    <h5 class="mb-0">{{ current_month_str }}</h5>
                    <a href="{% url 'scheduling:request_shift' %}?year={{ next_year }}&month={{ next_month }}" class="btn btn-sm btn-outline-primary">æ¬¡æœˆ &gt;</a>
                </div>
            </div>
            <div class="card-body p-2" id="calendar-container">
                {# å¸Œæœ›ã‚·ãƒ•ãƒˆè¡¨ç¤ºã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ #}
                {% get_shift_request_calendar user year month as calendar_html %}
                {{ calendar_html|safe }}
            </div>
        </div>
    </div>
</div>

{# 4. å€‹åˆ¥ç”³è«‹ãƒ¢ãƒ¼ãƒ€ãƒ« (æ—¥ä»˜ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§è¡¨ç¤º) #}
<div class="modal fade" id="individualRequestModal" tabindex="-1" aria-labelledby="individualRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="individualRequestModalLabel">
                    <span id="modalRequestDate">YYYYå¹´MMæœˆDDæ—¥</span> ã®ã‚·ãƒ•ãƒˆç”³è«‹
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="individualShiftForm" method="POST" action="{% url 'scheduling:submit_individual_shift' %}">
                {% csrf_token %}
                <input type="hidden" name="schedule_date" id="formScheduleDate">
                
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="id_start_time" class="form-label">é–‹å§‹æ™‚åˆ»</label>
                        <input type="time" name="start_time" id="id_start_time" class="form-control" value="00:00" required>
                    </div>
                    <div class="mb-3">
                        <label for="id_end_time" class="form-label">çµ‚äº†æ™‚åˆ»</label>
                        <input type="time" name="end_time" id="id_end_time" class="form-control" value="00:00" required>
                    </div>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" name="is_day_off" id="id_is_day_off">
                        <label class="form-check-label" for="id_is_day_off">
                            ã“ã®æ—¥ã‚’**ä¼‘ã¿å¸Œæœ›**ã¨ã—ã¦ç”³è«‹ã™ã‚‹
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger me-auto" id="cancelRequestBtn" style="display: none;">
                       ç”³è«‹ã‚’å–ã‚Šæ¶ˆã™
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>                     
                    <button type="submit" class="btn btn-primary" id="submitRequestBtn">ã“ã®å†…å®¹ã§ç”³è«‹</button>
                </div>
            </form>
        </div>
    </div>
</div>

{# 5. é€±å˜ä½ç”³è«‹ãƒ¢ãƒ¼ãƒ€ãƒ« (é€±ã”ã¨ã®åŸºæœ¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®š) #}
<div class="modal fade" id="weeklyRequestModal" tabindex="-1" aria-labelledby="weeklyRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="weeklyRequestModalLabel">ä¸€é€±é–“ã®åŸºæœ¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="weeklyShiftForm" method="POST" action="{% url 'scheduling:submit_weekly_shift' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <p class="text-muted mb-4">ä¸€é€±é–“ã®å‹¤å‹™å¯èƒ½ãªæ™‚é–“ï¼ˆæœ€å¤§ï¼‰ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„</p>

                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead>
                                <tr class="table-light">
                                    <th>æ›œæ—¥</th>
                                    <th>ä¼‘ã¿å¸Œæœ›</th>
                                    <th>é–‹å§‹æ™‚åˆ»</th>
                                    <th>çµ‚äº†æ™‚åˆ»</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for day_index, day_name in weekly_days %}
                                <tr>
                                    <td>{{ day_name }}</td>
                                    <td>
                                        <div class="form-check d-flex justify-content-center">
                                            <input class="form-check-input weekly-day-off" type="checkbox" 
                                                   name="is_day_off_{{ day_index }}" id="id_is_day_off_{{ day_index }}" 
                                                   data-day-index="{{ day_index }}">
                                        </div>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm weekly-start-time" 
                                               name="start_time_{{ day_index }}" id="id_start_time_{{ day_index }}" value="09:00">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm weekly-end-time" 
                                               name="end_time_{{ day_index }}" id="id_end_time_{{ day_index }}" value="18:00">
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-success">åŸºæœ¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const individualRequestModalEl = document.getElementById('individualRequestModal');
    const individualRequestModal = new bootstrap.Modal(individualRequestModalEl);
    const calendarContainer = document.getElementById('calendar-container');
    let calendar = null;
    if (calendarContainer) {
        // formatmonthå†…ã§ç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ.calendarï¼‰ã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰å–å¾—
        calendar = calendarContainer.querySelector('.calendar'); 
    }

    // ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å–å¾—
    const individualShiftForm = document.getElementById('individualShiftForm');
    const formScheduleDateEl = document.getElementById('formScheduleDate');
    const modalRequestDateEl = document.getElementById('modalRequestDate');
    const isDayOffCheckbox = document.getElementById('id_is_day_off');
    const startTimeInput = document.getElementById('id_start_time');
    const endTimeInput = document.getElementById('id_end_time');
    
    //åŸºæœ¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”³è«‹ã®è¦ç´ ã‚’å–å¾—
    const weeklyRequestButton = document.getElementById('weeklyRequestButton');
    const weeklyRequestModalEl = document.getElementById('weeklyRequestModal');
    const weeklyRequestModal = new bootstrap.Modal(weeklyRequestModalEl);
    const weeklyDayOffCheckboxes = document.querySelectorAll('.weekly-day-off');
    const weeklyStartTimeInputs = document.querySelectorAll('.weekly-start-time');
    const weeklyEndTimeInputs = document.querySelectorAll('.weekly-end-time');

    // ãƒœã‚¿ãƒ³è¦ç´ ã®å–å¾—
    const submitRequestBtn = document.getElementById('submitRequestBtn');
    const cancelRequestBtn = document.getElementById('cancelRequestBtn'); // è¿½åŠ ã—ãŸãƒœã‚¿ãƒ³

    // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³URLã¨ã€å–ã‚Šæ¶ˆã—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³URL
    const defaultActionUrl = individualShiftForm.action;
    const cancelActionUrl = "{% url 'scheduling:cancel_individual_shift' %}"; // Django URLã‚¿ã‚°ã‚’ä½¿ç”¨

    //æ—¥ä»˜ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒ­ã‚¸ãƒƒã‚¯
    function updateTimeInputsState(forceDefault = false) {
        const disabledState = isDayOffCheckbox.checked;
        startTimeInput.disabled = disabledState;
        endTimeInput.disabled = disabledState;
        
        if (disabledState) {
            // ä¼‘ã¿å¸Œæœ›ã®å ´åˆã¯æ™‚é–“ã‚’ã‚¯ãƒªã‚¢
            startTimeInput.value = '';
            endTimeInput.value = '';
        } else if (forceDefault) {
            // æœªç”³è«‹ã§å‹¤å‹™å¸Œæœ›ã®å ´åˆã€00:00ã«å¼·åˆ¶è¨­å®š
            startTimeInput.value = '00:00';
            endTimeInput.value = '00:00';
        } else {
            // ç”³è«‹æ¸ˆã¿ã‹ã‚‰å‹¤å‹™å¸Œæœ›ã«åˆ‡ã‚Šæ›¿ãˆãŸå ´åˆãªã©ã§ã€å€¤ãŒç©ºãªã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤(00:00)ã‚’å†è¨­å®š
            if (!startTimeInput.value) {
                startTimeInput.value = '00:00';
            }
            if (!endTimeInput.value) {
                endTimeInput.value = '00:00';
            }
        }
    }

    // ä¼‘ã¿å¸Œæœ›ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    isDayOffCheckbox.addEventListener('change', function() {
        // ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ã¯å¼·åˆ¶è¨­å®šã¯ä¸è¦ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã—ã¦ã„ã‚‹ãŸã‚)
        updateTimeInputsState(false); 
    });

    if (calendar) { 
        calendar.addEventListener('click', function(e) {
            let targetCell = e.target.closest('.clickable-cell');
            e.stopPropagation();

            if (targetCell && !targetCell.classList.contains('noday')) {
                const dateString = targetCell.dataset.date; // YYYY-MM-DD
                const dateObj = new Date(dateString);
                
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ã‚°ã§åŸ‹ã‚è¾¼ã¾ã‚ŒãŸ JSON ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                let shiftDetail = targetCell.dataset.shiftDetail;
                let data = {};
                
                try {
                    // &quot; ã‚’ " ã«æˆ»ã—ã¦ã‹ã‚‰ JSON è§£æ
                    if (shiftDetail) {
                        data = JSON.parse(shiftDetail.replace(/&quot;/g, '"'));
                    }
                } catch (error) {
                    console.error("ã‚·ãƒ•ãƒˆè©³ç´°ãƒ‡ãƒ¼ã‚¿ã®è§£æã‚¨ãƒ©ãƒ¼:", error);
                }
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’è¡¨ç¤º
                const displayDate = `${dateObj.getFullYear()}å¹´${dateObj.getMonth() + 1}æœˆ${dateObj.getDate()}æ—¥`;
                modalRequestDateEl.textContent = displayDate;
                formScheduleDateEl.value = dateString;

                // ãƒ•ã‚©ãƒ¼ãƒ ã®actionã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                individualShiftForm.action = defaultActionUrl;
                
                // --- ãƒ•ã‚©ãƒ¼ãƒ ã®åˆæœŸå€¤è¨­å®šãƒ­ã‚¸ãƒƒã‚¯ ---
                // data.status ãŒå­˜åœ¨ã™ã‚Œã°ç”³è«‹æ¸ˆã¿ã¨åˆ¤æ–­ (calendar_tags.py ã®ãƒ­ã‚¸ãƒƒã‚¯ã«ä¾å­˜)
                const isRequested = data && data.status; 
                
                if (isRequested) {
                    // A. ç”³è«‹æ¸ˆã¿ã®å ´åˆ:
                    
                    // 1. å–ã‚Šæ¶ˆã—ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                    cancelRequestBtn.style.display = 'block'; 
                    submitRequestBtn.textContent = 'ã‚·ãƒ•ãƒˆã‚’æ›´æ–°';

                    if (data.is_day_off) {
                        // ä¼‘ã¿å¸Œæœ›ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
                        isDayOffCheckbox.checked = true;
                        startTimeInput.value = ''; // ä¼‘ã¿å¸Œæœ›ãªã®ã§æ™‚é–“ã¯ã‚¯ãƒªã‚¢
                        endTimeInput.value = '';
                    } else {
                        // å‹¤å‹™å¸Œæœ›ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
                        isDayOffCheckbox.checked = false;
                        // ç”³è«‹ã•ã‚ŒãŸæ™‚é–“ã‚’è¨­å®šï¼ˆæœªè¨­å®šã®å ´åˆã¯ '00:00' ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                        startTimeInput.value = data.start_time || '00:00';
                        endTimeInput.value = data.end_time || '00:00';
                    }
                } else {
                    // B. æœªç”³è«‹ã®å ´åˆ:
                    
                    // 1. å–ã‚Šæ¶ˆã—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
                    cancelRequestBtn.style.display = 'none'; 
                    submitRequestBtn.textContent = 'ã“ã®å†…å®¹ã§ç”³è«‹';

                    // 2. åˆæœŸå€¤ã‚’ 00:00 ã«è¨­å®šã—ã€ä¼‘ã¿å¸Œæœ›ãƒã‚§ãƒƒã‚¯ã‚’è§£é™¤
                    isDayOffCheckbox.checked = false;
                    startTimeInput.value = '00:00';
                    endTimeInput.value = '00:00';
                }
                
                // ä¼‘ã¿å¸Œæœ›ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¼·åˆ¶å®Ÿè¡Œ
                // æœªç”³è«‹ã®å ´åˆã¯ã€forceDefault=trueã§00:00ã‚’ä¿è¨¼
                updateTimeInputsState(!isRequested); 

                individualRequestModal.show();
            }
        });
    }

    // ç”³è«‹å–ã‚Šæ¶ˆã—ãƒœã‚¿ãƒ³ã®å‡¦ç†
    if (cancelRequestBtn) {
        cancelRequestBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const scheduleDate = formScheduleDateEl.value;
            if (confirm(`${scheduleDate} ã®ã‚·ãƒ•ãƒˆç”³è«‹ã‚’å–ã‚Šæ¶ˆã—ã¾ã™ã‹ï¼Ÿ`)) {
                // ãƒ•ã‚©ãƒ¼ãƒ ã® action ã‚’å–ã‚Šæ¶ˆã—ç”¨ã®URLã«å¤‰æ›´
                individualShiftForm.action = cancelActionUrl;
                // POSTã§é€ä¿¡
                individualShiftForm.submit(); 
            }
        });
    }

    // åŸºæœ¬ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”³è«‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    if (weeklyRequestButton) {
        weeklyRequestButton.addEventListener('click', function() {
            weeklyRequestModal.show();
        });
    }

    // --- é€±å˜ä½ç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ­ã‚¸ãƒƒã‚¯ ---
    // ä¼‘ã¿å¸Œæœ›ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã€æ™‚é–“å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ‰åŠ¹/ç„¡åŠ¹åŒ–ã™ã‚‹
    weeklyDayOffCheckboxes.forEach(checkbox => {
        const dayIndex = checkbox.dataset.dayIndex;
        const startTimeInput = document.getElementById(`id_start_time_${dayIndex}`);
        const endTimeInput = document.getElementById(`id_end_time_${dayIndex}`);

        function updateWeeklyTimeInputs() {
            const isDisabled = checkbox.checked;
            
            startTimeInput.disabled = isDisabled;
            endTimeInput.disabled = isDisabled;

            if (isDisabled) {
                // ä¼‘ã¿å¸Œæœ›ã®å ´åˆã¯æ™‚é–“ã‚’ã‚¯ãƒªã‚¢
                startTimeInput.value = '';
                endTimeInput.value = '';
            } else if (!startTimeInput.value) {
                 // ä¼‘ã¿å¸Œæœ›ã‚’è§£é™¤ã—ãŸå ´åˆã€ç©ºãªã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å†è¨­å®š
                 startTimeInput.value = '09:00';
                 endTimeInput.value = '18:00';
            }
        }

        // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã¨å¤‰æ›´æ™‚ã«é©ç”¨
        updateWeeklyTimeInputs(); 
        checkbox.addEventListener('change', updateWeeklyTimeInputs);
    });
});
</script>
<style>
.calendar-day {
    height: 70px; /* ã‚»ãƒ«ã®é«˜ã•ã‚’ç¢ºä¿ */
    width: 50px;
    padding: 3px !important; /* ã‚»ãƒ«å†…ã®ä½™ç™½ã‚’èª¿æ•´ */
    vertical-align: top; /* å†…å®¹ã‚’ä¸Šå¯„ã› */
    font-size: 0.9em;
}

.calendar.table-bordered {
    table-layout: fixed; /* ğŸš¨ å¿…é ˆ: ã‚»ãƒ«ã®å¹…ã‚’å›ºå®šã—ã€å†…å®¹ã«ã‚ˆã£ã¦ä¼¸ç¸®ã•ã›ãªã„ */
    width: 100%;
}

.calendar td {
    height: 70px; /* ğŸš¨ å¿…é ˆ: ã‚»ãƒ«ã®é«˜ã•ã‚’å›ºå®š (ä¾‹ã¨ã—ã¦90px) */
    vertical-align: top; /* æ—¥ä»˜ç•ªå·ã‚’ã‚»ãƒ«ã®ä¸Šéƒ¨ã«æƒãˆã‚‹ */
    padding: 5px;
    position: relative; /* å­è¦ç´  (ã‚·ãƒ•ãƒˆæƒ…å ±) ã®é…ç½®åŸºæº–ã«ã™ã‚‹ */
}

.calendar td .shift-time,
.calendar td .shift-status {
    position: absolute; /* çµ¶å¯¾é…ç½®ã«å¤‰æ›´ */
    left: 5px; /* å·¦ç«¯ã‹ã‚‰ã®ä½ç½®èª¿æ•´ */
    right: 5px; /* å³ç«¯ã‹ã‚‰ã®ä½ç½®èª¿æ•´ */
    text-align: center; /* ä¸­å¤®æƒãˆã«ã™ã‚‹ */
    /* font-size, margin-top, etc. ã¯å†…å®¹ã«å¿œã˜ã¦èª¿æ•´ */
}

.calendar td .shift-time {
    bottom: 10px; /* ğŸš¨ å¿…é ˆ: ä¸‹ç«¯ã‹ã‚‰5pxã®ä½ç½®ã«é…ç½® */
    /* æŠ˜ã‚Šè¿”ã—ã«é•å’Œæ„ŸãŒãªã„ã‚ˆã†ã«æ–‡å­—ã‚’å°ã•ãã—ã€è¡Œé–“ã‚’èª¿æ•´ */
    font-size: 0.75em; /* ğŸš¨ ã”è¦æœ›: å‹¤å‹™æ™‚é–“è¡¨ç¤ºã®æ–‡å­—ã‚’å°ã•ã */
    line-height: 1.2;
    overflow-wrap: break-word; /* é•·ã™ãã‚‹å ´åˆã«å‚™ãˆã¦æŠ˜ã‚Šè¿”ã—ã‚’è¨±å¯ */
}

.calendar td .shift-status {
    bottom: 35px; /* shift-time ã®é«˜ã•ã«åˆã‚ã›ã¦é…ç½®ã‚’èª¿æ•´ */
    font-size: 0.7em;
    color: #888;
}

.calendar td .day-num {
    display: block;
    text-align: left;
    font-size: 0.9em;
    font-weight: bold;
    margin-bottom: 3px;
    /* æ—¥ä»˜ç•ªå·ã¯ä¸Šéƒ¨å·¦ã«é…ç½® */
}

#calendar-container {
    pointer-events: none; 
}

/* 2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãã®ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªã‚»ãƒ«ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’æˆ»ã™ */
/* é€éè¨­å®šã‚’ç„¡åŠ¹ã«ã—ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚»ãƒ«ã ã‘ã¯ã‚¯ãƒªãƒƒã‚¯ã‚’å—ã‘ä»˜ã‘ã‚‹ */
#calendar-container .calendar,
#calendar-container .clickable-cell {
    pointer-events: auto; 
    
    /* z-indexã‚’æœ‰åŠ¹ã«ã—ã€ä»–ã®è¦ç´ ã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ */
    position: relative; 
    z-index: 10;
}

/* æ—¥ä»˜ç•ªå· */
.day-num {
    float: right;
    font-weight: bold;
    font-size: 1.1em;
}

/* é€±æœ«ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
.sunday .day-num {
    color: #dc3545; /* èµ¤ */
}
.saturday .day-num {
    color: #0d6efd; /* é’ */
}
.has-request-shift {
    background-color: #f0f8ff; /* æ·¡ã„é’ */
}

/* å¸Œæœ›ã‚·ãƒ•ãƒˆã‚ã‚Šã®ã‚»ãƒ« */
.has-request-shift {
    background-color: #e9f0ff; /* æ·¡ã„é’ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
}

/* ã‚·ãƒ•ãƒˆæƒ…å ±ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */
.shift-info {
    font-size: 0.75em;
    clear: both; /* æ—¥ä»˜ç•ªå·ã®ä¸‹ã«è¡¨ç¤º */
    line-height: 1.2;
}
.shift-status {
    font-size: 0.6em;
    padding: 0 4px;
    border-radius: 3px;
    display: inline-block;
    margin-top: 2px;
}

/* æ‰¿èªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
.shift-status {
    font-size: 0.65em;
    padding: 0 2px;
    border-radius: 3px;
    display: inline-block;
    margin-top: 1px;
}

/* æ‰¿èªä¸­ (pending) */
.status-pending {
    background-color: #ffc107; /* Yellow */
    color: #333;
}

/* æ‰¿èªæ¸ˆã¿ (approved) */
.status-approved {
    background-color: #28a745; /* Green */
    color: white;
}

/* å´ä¸‹ (rejected) */
.status-rejected {
    background-color: #dc3545; /* Red */
    color: white;
}
</style>
{% endblock %}
